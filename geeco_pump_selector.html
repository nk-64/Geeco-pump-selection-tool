<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Geeco Pump Selector – Offline Prototype</title>
<style>
  :root{
    --bg:#0f1115; --card:#171a20; --muted:#a5adba; --text:#e6e7ea; --accent:#6ea8fe; --good:#7dd97d; --warn:#ffd166; --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--text);}
  header{padding:18px 20px; border-bottom:1px solid #222; background:linear-gradient(180deg,#121521,#0f1115); position:sticky; top:0; z-index:10}
  header h1{margin:0; font-size:18px; letter-spacing:.2px}
  .container{max-width:1100px; margin:0 auto; padding:20px}
  .grid{display:grid; gap:14px}
  .cols-2{grid-template-columns: repeat(2, minmax(0,1fr))}
  @media(max-width:900px){.cols-2{grid-template-columns:1fr}}
  .card{background:var(--card); border:1px solid #222; border-radius:10px; padding:16px}
  label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
  input, select{width:100%; background:#0e1117; border:1px solid #2a2f3a; color:var(--text); border-radius:8px; padding:10px 12px; outline:none}
  input:focus, select:focus{border-color:#3a85ff; box-shadow:0 0 0 3px rgba(58,133,255,.15)}
  .row{display:flex; gap:10px; align-items:center}
  .row>*{flex:1}
  .btn{background:#1a2233; border:1px solid #2d3a52; color:var(--text); padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600}
  .btn.primary{background:var(--accent); border-color:#6ea8fe; color:#0b1020}
  .btn:disabled{opacity:.5; cursor:not-allowed}
  .stepper{display:flex; gap:8px; margin:0 0 14px 0; flex-wrap:wrap}
  .chip{padding:6px 10px; border-radius:999px; background:#121520; border:1px solid #242a36; font-size:12px; color:var(--muted)}
  .chip.active{background:#0e1a33; color:#bcd6ff; border-color:#29487a}
  .muted{color:var(--muted)}
  .hint{font-size:12px; color:#aab3c2}
  .result{border-left:4px solid #2e3441; padding-left:12px; margin:8px 0; display:grid; gap:4px}
  .score{font-weight:700}
  .tag{display:inline-block; padding:3px 8px; border-radius:999px; background:#0f1320; border:1px solid #263047; color:#c7d3ea; font-size:11px; margin-right:6px}
  .good{color:#0b5; border-color:#0b5; background:rgba(0,187,85,.08)}
  .warn{color:#d9a20b; border-color:#d9a20b; background:rgba(217,162,11,.08)}
  .bad{color:#e44; border-color:#e44; background:rgba(238,68,68,.08)}
  .footer{font-size:12px; color:var(--muted); margin-top:8px}
  textarea{width:100%; min-height:180px; background:#0e1117; border:1px solid #2a2f3a; color:var(--text); border-radius:8px; padding:10px 12px; outline:none}
  .inline{display:inline-flex; gap:8px; align-items:center}
  .pill{padding:2px 8px; border-radius:999px; background:#101521; border:1px solid #2a3142; color:#b7c2d6; font-size:11px}
</style>
</head>
<body>
<header>
  <h1>Geeco Pump Selector – Offline Prototype</h1>
  <div class="hint">Guided by Moglix’s buying flow: purpose → power/source → distances → water quality → matches</div>
</header>

<div class="container grid cols-2">
  <section class="card">
    <div class="stepper" id="stepper"></div>
    <div id="steps"></div>
    <div class="row" style="margin-top:10px">
      <button id="prev" class="btn">Back</button>
      <button id="next" class="btn primary">Next</button>
    </div>
    <div class="footer">Local-only. No build tools. Save this page and open in any browser. Edit catalog at the right.</div>
  </section>

  <aside class="card">
    <div class="row">
      <div class="inline"><span class="pill">Duty point</span></div>
      <div class="inline"><span class="pill" id="calcSummary">—</span></div>
      <button id="recalc" class="btn">Recalculate</button>
    </div>
    <div style="height:10px"></div>
    <div id="matches"></div>
    <div style="height:14px"></div>
    <h3 style="margin:6px 0 6px">Catalog (editable JSON)</h3>
    <textarea id="catalog"></textarea>
    <div class="row" style="margin-top:8px">
      <button id="applyCatalog" class="btn">Apply</button>
      <button id="downloadCSV" class="btn">Export CSV</button>
    </div>
    <div class="footer">
      Scoring favors range fit around the computed duty point, phase/source match, solids tolerance, and mounting constraints.
      Replace with real pump curves/NPSH when you’re ready.
    </div>
  </aside>
</div>

<script>
// --- Mock Catalog (edit on the right). Values are illustrative placeholders. ---
const defaultCatalog = [
  {
    brand:"Geeco", series:"Little King", model:"LK-0.5HP",
    type:"self-priming", phase:"single", power_hp:0.5,
    flow_lpm_min:10, flow_lpm_max:60,
    head_m_min:6, head_m_max:28,
    solids_mm:0, suction_lift_m_max:6, mounting:"surface",
    notes:"Domestic boosting, small homes"
  },
  {
    brand:"Geeco", series:"Little King Plus", model:"LKP-1.0HP",
    type:"self-priming", phase:"single", power_hp:1.0,
    flow_lpm_min:20, flow_lpm_max:90,
    head_m_min:10, head_m_max:38,
    solids_mm:0, suction_lift_m_max:7, mounting:"surface",
    notes:"Higher head, single-phase"
  },
  {
    brand:"Geeco", series:"Smart PLUS", model:"SMART-1.0HP",
    type:"self-priming", phase:"single", power_hp:1.0,
    flow_lpm_min:25, flow_lpm_max:95,
    head_m_min:8, head_m_max:36,
    solids_mm:2, suction_lift_m_max:7, mounting:"surface",
    notes:"Self-priming with better suction, optional dry-run guard"
  },
  {
    brand:"Geeco", series:"Hero", model:"HERO-1.5HP",
    type:"self-priming", phase:"single", power_hp:1.5,
    flow_lpm_min:40, flow_lpm_max:120,
    head_m_min:10, head_m_max:42,
    solids_mm:2, suction_lift_m_max:7, mounting:"surface",
    notes:"Higher flow single-phase"
  },
  {
    brand:"Geeco", series:"Amphibian", model:"AMP-1.5HP",
    type:"amphibian-monoblock", phase:"single", power_hp:1.5,
    flow_lpm_min:40, flow_lpm_max:140,
    head_m_min:8, head_m_max:36,
    solids_mm:6, suction_lift_m_max:0, mounting:"submerged",
    notes:"Water-cooled monoblock; tolerant of wet pits"
  },
  {
    brand:"Geeco", series:"Openwell Submersible", model:"OWS-2HP",
    type:"openwell-submersible", phase:"single", power_hp:2.0,
    flow_lpm_min:60, flow_lpm_max:220,
    head_m_min:8, head_m_max:28,
    solids_mm:4, suction_lift_m_max:0, mounting:"submerged",
    notes:"Open wells; low head, high flow"
  },
  {
    brand:"Geeco", series:"Borewell Submersible", model:"BWS-1.5HP-20S",
    type:"borewell-submersible", phase:"single", power_hp:1.5,
    flow_lpm_min:20, flow_lpm_max:120,
    head_m_min:20, head_m_max:90,
    solids_mm:0, suction_lift_m_max:0, mounting:"submerged",
    notes:"4-inch borewells; multi-stage"
  },
  {
    brand:"Geeco", series:"Borewell Submersible", model:"BWS-3HP-30S",
    type:"borewell-submersible", phase:"three", power_hp:3.0,
    flow_lpm_min:40, flow_lpm_max:160,
    head_m_min:30, head_m_max:140,
    solids_mm:0, suction_lift_m_max:0, mounting:"submerged",
    notes:"Three-phase; deeper heads"
  }
];

// --- Wizard State ---
const state = {
  // Step 1: purpose & power
  use_case:"home", // home, farm, dewatering, overhead-tank, garden, commercial
  outlets:2,
  usage_level:"moderate", // low, moderate, high
  phase:"single", // single, three
  source_type:"ground_tank", // ground_tank, open_well, borewell, sump, river
  // Step 2: distances
  static_suction: 1,    // m below pump (if surface)
  static_delivery: 10,  // m up to tank/outlet
  horizontal_run: 15,   // m
  pipe_diam_mm: 25,     // mm (1")
  // Step 3: water & automation
  water_quality:"clean", // clean, sandy, dirty, sewage
  solids_mm:0,
  needs_dry_run:false,
  auto_on_off:false,
  mounting_pref:"any", // any, surface, submerged
  // Derived
  est_flow_lpm: 0,
  head_m: 0,
  catalog: JSON.parse(JSON.stringify(defaultCatalog))
};

// --- Utility: Estimate Flow by outlets & usage ---
function estimateFlow(outlets, level){
  const perTap = level==="low" ? 6 : level==="high" ? 12 : 9; // LPM per tap
  return Math.max(6, outlets * perTap);
}

// --- Utility: Friction loss rough model (Hazen-Williams-ish simplification) ---
// return meters head loss for given L (m), Q (LPM), D (mm)
function frictionLossMeters(L, Q_lpm, D_mm){
  // Simple empirical: loss_per_100m by diameter and flow bucket
  // Conservative roughness for common plastic pipes
  const table = [
    {D:20, buckets:[{q:10, loss:6}, {q:20, loss:13}, {q:40, loss:32}, {q:80, loss:90}]},
    {D:25, buckets:[{q:10, loss:3}, {q:20, loss:7}, {q:40, loss:16}, {q:80, loss:46}]},
    {D:32, buckets:[{q:10, loss:1.5}, {q:20, loss:3}, {q:40, loss:8}, {q:80, loss:22}]},
    {D:40, buckets:[{q:10, loss:1}, {q:20, loss:2}, {q:40, loss:5}, {q:80, loss:14}]}
  ];
  const nearest = table.reduce((a,b)=>Math.abs(b.D-D_mm)<Math.abs(a.D-D_mm)?b:a, table[0]);
  const bucket = nearest.buckets.find(b=>Q_lpm<=b.q) || nearest.buckets[nearest.buckets.length-1];
  const lossPer100 = bucket.loss; // m per 100m
  return (L/100) * lossPer100;
}

// --- Compute duty point ---
function computeDuty(){
  // Flow
  state.est_flow_lpm = estimateFlow(state.outlets, state.usage_level);

  // Static head
  const suctionHead = (state.mounting_pref==="surface" || state.source_type!=="borewell") ? Math.max(0, state.static_suction) : 0;
  const deliveryHead = Math.max(0, state.static_delivery);

  // Friction
  const friction = frictionLossMeters(state.horizontal_run, state.est_flow_lpm, state.pipe_diam_mm);

  // Total head
  state.head_m = +(suctionHead + deliveryHead + friction).toFixed(1);
}

// --- Scoring ---
function scorePump(p){
  let score = 0;
  // Range fit: head and flow within min/max; reward closeness to midrange
  const flowMid = (p.flow_lpm_min + p.flow_lpm_max)/2;
  const headMid = (p.head_m_min + p.head_m_max)/2;
  const inFlow = state.est_flow_lpm>=p.flow_lpm_min && state.est_flow_lpm<=p.flow_lpm_max;
  const inHead = state.head_m>=p.head_m_min && state.head_m<=p.head_m_max;

  if(inFlow) score += 30 - Math.min(30, Math.abs(state.est_flow_lpm - flowMid)/flowMid*30);
  if(inHead) score += 30 - Math.min(30, Math.abs(state.head_m - headMid)/headMid*30);
  if(!inFlow || !inHead) score -= 10;

  // Phase/source constraints
  if(p.phase===state.phase) score += 10; else score -= 8;

  // Mounting preference
  if(state.mounting_pref!=="any"){
    if(p.mounting===state.mounting_pref) score += 8; else score -= 8;
  }

  // Solids handling vs water quality
  const solidsNeed = state.water_quality==="clean" ? 0 :
                     state.water_quality==="sandy" ? Math.max(2, state.solids_mm) :
                     state.water_quality==="dirty" ? Math.max(4, state.solids_mm) :
                     Math.max(10, state.solids_mm); // sewage-like
  if(p.solids_mm >= solidsNeed) score += 8; else score -= 10;

  // Suction lift needs if surface
  if(state.mounting_pref==="surface" || p.type.includes("self-priming")){
    if(p.suction_lift_m_max >= state.static_suction) score += 6; else score -= 6;
  }

  // Power sanity: nudge up if power looks proportionate to demand
  const demandIdx = (state.est_flow_lpm * state.head_m) / 1000; // crude
  const hpBias = demandIdx < 1.5 ? (p.power_hp<=1.0?5:0) : demandIdx < 3 ? (p.power_hp<=2?4:1) : (p.power_hp>=2?3:0);
  score += hpBias;

  return Math.round(score);
}

function badge(text, cls=""){
  return `<span class="tag ${cls}">${text}</span>`;
}

// --- UI ---
const steps = [
  {
    title:"Purpose & Power",
    render:()=>`
      <div class="grid">
        <div>
          <label>Use case</label>
          <select id="use_case">
            <option value="home">Home / Apartment</option>
            <option value="overhead-tank">Overhead tank filling</option>
            <option value="garden">Garden / Lawn</option>
            <option value="farm">Farm / Irrigation</option>
            <option value="dewatering">Dewatering / Construction</option>
            <option value="commercial">Small commercial</option>
          </select>
        </div>
        <div class="row">
          <div>
            <label>Outlets in use at once</label>
            <input id="outlets" type="number" min="1" max="12" value="${state.outlets}"/>
          </div>
          <div>
            <label>Usage level</label>
            <select id="usage_level">
              <option value="low">Low</option>
              <option value="moderate" selected>Moderate</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Power phase available</label>
            <select id="phase">
              <option value="single">Single phase</option>
              <option value="three">Three phase</option>
            </select>
          </div>
          <div>
            <label>Water source</label>
            <select id="source_type">
              <option value="ground_tank">Ground tank</option>
              <option value="open_well">Open well</option>
              <option value="borewell">Borewell</option>
              <option value="sump">Basement sump</option>
              <option value="river">River/pond</option>
            </select>
          </div>
        </div>
        <div class="hint">Tip: Homes think in taps, not LPM. We convert that to flow automatically.</div>
      </div>`,
    init:()=>{
      ["use_case","usage_level","phase","source_type","outlets"].forEach(id=>{
        const el = document.getElementById(id);
        if(id==="use_case") el.value = state.use_case;
        if(id==="usage_level") el.value = state.usage_level;
        if(id==="phase") el.value = state.phase;
        if(id==="source_type") el.value = state.source_type;
        el.addEventListener("input", ()=>{
          if(id==="outlets") state[id] = Math.max(1, parseInt(el.value||1,10));
          else state[id] = el.value;
          updateSummary();
        });
      });
    }
  },
  {
    title:"Distances & Pipe",
    render:()=>`
      <div class="grid">
        <div class="row">
          <div>
            <label>Static suction (m)</label>
            <input id="static_suction" type="number" min="0" max="8" step="0.1" value="${state.static_suction}"/>
          </div>
          <div>
            <label>Static delivery height (m)</label>
            <input id="static_delivery" type="number" min="0" max="80" step="0.1" value="${state.static_delivery}"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Horizontal run (m)</label>
            <input id="horizontal_run" type="number" min="0" max="200" step="1" value="${state.horizontal_run}"/>
          </div>
          <div>
            <label>Pipe diameter (mm)</label>
            <select id="pipe_diam_mm">
              <option>20</option><option selected>25</option><option>32</option><option>40</option>
            </select>
          </div>
        </div>
        <div class="hint">We add friction loss based on pipe size and length so head isn’t a guess.</div>
      </div>`,
    init:()=>{
      ["static_suction","static_delivery","horizontal_run","pipe_diam_mm"].forEach(id=>{
        const el = document.getElementById(id);
        el.value = state[id];
        el.addEventListener("input", ()=>{
          state[id] = id==="pipe_diam_mm" ? parseInt(el.value,10) : parseFloat(el.value||0);
          updateSummary();
        });
      });
    }
  },
  {
    title:"Water & Controls",
    render:()=>`
      <div class="grid">
        <div class="row">
          <div>
            <label>Water quality</label>
            <select id="water_quality">
              <option value="clean">Clean</option>
              <option value="sandy">Sandy</option>
              <option value="dirty">Dirty</option>
              <option value="sewage">Sewage-like</option>
            </select>
          </div>
          <div>
            <label>Max solids (mm, if any)</label>
            <input id="solids_mm" type="number" min="0" max="20" step="1" value="${state.solids_mm}"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Mounting preference</label>
            <select id="mounting_pref">
              <option value="any">Any</option>
              <option value="surface">Surface</option>
              <option value="submerged">Submerged</option>
            </select>
          </div>
          <div class="row" style="gap:16px">
            <label class="inline"><input id="needs_dry_run" type="checkbox"/> <span>Dry‑run protection</span></label>
            <label class="inline"><input id="auto_on_off" type="checkbox"/> <span>Auto on/off (float/pressure)</span></label>
          </div>
        </div>
        <div class="hint">Solids tolerance and automation are practical buying factors.</div>
      </div>`,
    init:()=>{
      [["water_quality","value"],["mounting_pref","value"]].forEach(([id,prop])=>{
        const el = document.getElementById(id); el[prop] = state[id];
        el.addEventListener("input", ()=>{ state[id]=el.value; updateSummary(); });
      });
      [["solids_mm","number"],["needs_dry_run","checkbox"],["auto_on_off","checkbox"]].forEach(([id,kind])=>{
        const el=document.getElementById(id);
        if(kind==="number") el.value = state[id];
        if(kind==="checkbox") el.checked = state[id];
        el.addEventListener("input", ()=>{
          state[id] = kind==="checkbox" ? el.checked : parseFloat(el.value||0);
          updateSummary();
        });
      });
    }
  },
  {
    title:"Results",
    render:()=>`
      <div class="grid">
        <div class="hint">We rank by fit to the computed duty point, phase/mounting match, and solids tolerance.</div>
        <div id="resultsList"></div>
      </div>`,
    init:()=>renderMatches()
  }
];

let currentStep = 0;

function renderStepper(){
  const el = document.getElementById("stepper");
  el.innerHTML = steps.map((s, i)=>`<span class="chip ${i===currentStep?'active':''}">${i+1}. ${s.title}</span>`).join("");
}

function renderStep(){
  const el = document.getElementById("steps");
  el.innerHTML = steps[currentStep].render();
  steps[currentStep].init();
  renderStepper();
  document.getElementById("prev").disabled = currentStep===0;
  document.getElementById("next").textContent = currentStep===steps.length-1?"Finish":"Next";
  updateSummary();
}

function updateSummary(){
  computeDuty();
  const txt = `${state.est_flow_lpm} LPM @ ${state.head_m} m`;
  document.getElementById("calcSummary").textContent = txt;
  if(currentStep===steps.length-1) renderMatches();
}

function renderMatches(){
  const ranked = state.catalog.map(p=>({p, score:scorePump(p)})).sort((a,b)=>b.score-a.score);
  const list = document.getElementById("resultsList") || document.getElementById("matches");

  const rows = ranked.map(({p,score})=>{
    const inFlow = state.est_flow_lpm>=p.flow_lpm_min && state.est_flow_lpm<=p.flow_lpm_max;
    const inHead = state.head_m>=p.head_m_min && state.head_m<=p.head_m_max;
    const fitClass = (inFlow&&inHead) ? "good" : (!inFlow&&!inHead?"bad":"warn");
    const tags = [
      badge(`${p.flow_lpm_min}-${p.flow_lpm_max} LPM`),
      badge(`${p.head_m_min}-${p.head_m_max} m`),
      badge(`${p.phase} phase`),
      badge(p.mounting),
      badge(`solids ${p.solids_mm}mm`),
      badge(`${p.power_hp} HP`)
    ].join(" ");
    return `<div class="result">
      <div class="row" style="align-items:baseline">
        <div style="flex:2"><strong>${p.brand} ${p.series}</strong> <span class="muted">— ${p.model}</span></div>
        <div class="score" style="flex:0">${score}</div>
      </div>
      <div>${tags}</div>
      <div class="${fitClass} tag">Fit: ${inFlow&&inHead?"In-range":"Partial/Out-of-range"}</div>
      <div class="muted">${p.notes||""}</div>
    </div>`;
  }).join("");

  list.innerHTML = rows || "<div class='muted'>No matches. Loosen constraints or edit catalog.</div>";
}

// Catalog editor
const catalogEl = document.getElementById("catalog");
catalogEl.value = JSON.stringify(defaultCatalog, null, 2);

document.getElementById("applyCatalog").addEventListener("click", ()=>{
  try{
    const parsed = JSON.parse(catalogEl.value);
    if(!Array.isArray(parsed)) throw new Error("Catalog must be an array.");
    state.catalog = parsed;
    renderMatches();
    alert("Catalog applied.");
  }catch(e){
    alert("Catalog error: " + e.message);
  }
});

// CSV export
document.getElementById("downloadCSV").addEventListener("click", ()=>{
  const headers = ["brand","series","model","type","phase","power_hp","flow_lpm_min","flow_lpm_max","head_m_min","head_m_max","solids_mm","suction_lift_m_max","mounting","notes","score"];
  const rows = state.catalog.map(p=>{
    const score = scorePump(p);
    return headers.map(h=> (h==="score"?score:(p[h]??"")) ).join(",");
  });
  const csv = [headers.join(","), ...rows].join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "geeco_pump_matches.csv";
  a.click();
  URL.revokeObjectURL(url);
});

// Recalc button
document.getElementById("recalc").addEventListener("click", ()=>{
  updateSummary();
  renderMatches();
});

// Navigation
document.getElementById("prev").addEventListener("click", ()=>{
  if(currentStep>0){ currentStep--; renderStep(); }
});
document.getElementById("next").addEventListener("click", ()=>{
  if(currentStep<steps.length-1){ currentStep++; renderStep(); }
});

// Initial render
renderStep();
</script>
</body>
</html>
